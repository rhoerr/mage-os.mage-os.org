---
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import type { CallToAction, Widget } from '~/types';
import Button from '~/components/ui/Button.astro';

interface Props extends Widget {
  title?: string;
  subtitle?: string;
  tagline?: string;
  callToAction?: CallToAction;
  actions?: string | CallToAction[];
}

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline = await Astro.slots.render('tagline'),
  actions = await Astro.slots.render('actions'),

  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;

// Transform actions to use inverted/ghost variants on gradient background
const transformedActions = Array.isArray(actions)
  ? actions.map((action, index) => ({
      ...action,
      variant: (index === 0 ? 'inverted' : 'ghost') as 'inverted' | 'ghost',
    }))
  : actions;
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-6xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <div
    class="relative max-w-4xl mx-auto text-center px-8 py-12 md:py-16 rounded-2xl overflow-hidden"
    style="background: linear-gradient(135deg, var(--aw-gradient-start) 0%, var(--aw-gradient-middle) 50%, var(--aw-gradient-end) 100%);"
  >
    <!-- Decorative elements -->
    <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"></div>
    <div class="absolute bottom-0 left-0 w-48 h-48 bg-white/5 rounded-full translate-y-1/2 -translate-x-1/2"></div>

    <div class="relative z-10">
      {
        tagline && (
          <span
            class="inline-flex items-center mb-4 px-3 py-1 text-sm font-medium rounded-full bg-white/20 text-white"
            set:html={tagline}
          />
        )
      }
      {
        title && (
          <h2
            class="text-3xl md:text-4xl lg:text-5xl font-bold tracking-tight mb-4 font-heading text-white"
            set:html={title}
          />
        )
      }
      {subtitle && <p class="text-lg md:text-xl text-white max-w-2xl mx-auto" set:html={subtitle} />}
      {
        transformedActions && (
          <div class="max-w-xs sm:max-w-md m-auto flex flex-nowrap flex-col sm:flex-row sm:justify-center gap-4 mt-8">
            {Array.isArray(transformedActions) ? (
              transformedActions.map((action) => (
                <div class="flex w-full sm:w-auto">
                  <Button {...(action || {})} class="w-full sm:mb-0 whitespace-nowrap" />
                </div>
              ))
            ) : (
              <Fragment set:html={transformedActions} />
            )}
          </div>
        )
      }
    </div>
  </div>
</WidgetWrapper>
